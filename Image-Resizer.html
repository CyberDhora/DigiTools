<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gradient Image Crop Tool</title>
  <style>
    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
      font-family: 'Segoe UI', sans-serif;
    }
    .container {
      max-width: 400px;
      margin: 30px auto;
      background: rgba(255,255,255,0.95);
      border-radius: 18px;
      box-shadow: 0 10px 26px rgba(0,0,0,0.12);
      padding: 18px;
    }
    h2, h3 {
      color: #2ebf91;
      margin-top: 0;
    }
    input[type="file"] {
      margin-bottom: 18px;
    }
    .canvas-wrapper {
      position: relative;
      width: 100%;
      max-width: 320px;
      margin: 0 auto;
    }
    #imageCanvas {
      width: 100%;
      height: auto;
      border-radius: 12px;
      display: block;
    }
    #cropBox {
      position: absolute;
      border: 2px dashed #8360c3;
      background: rgba(131,96,195,0.13);
      display: none;
      cursor: move;
    }
    button, a#downloadBtn {
      display: inline-block;
      margin: 16px 0 0 0;
      padding: 10px 22px;
      font-size: 1em;
      font-weight: bold;
      border: 0;
      border-radius: 24px;
      background: linear-gradient(90deg, #8360c3 0%, #2ebf91 100%);
      color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.12);
      text-decoration: none;
      text-align: center;
      transition: box-shadow 0.2s;
    }
    button:hover, a#downloadBtn:hover {
      box-shadow: 0 6px 18px rgba(46,191,145,0.18);
    }
    .preview {
      margin-top: 18px;
      text-align: center;
    }
    #previewCanvas {
      margin-top: 10px;
      border-radius: 10px;
      width: 100%;
      max-width: 240px;
      background: #f3f3f3;
    }
    @media (max-width: 500px) {
      .container {
        max-width: 96vw;
        padding: 2vw;
      }
      .canvas-wrapper {
        max-width: 96vw;
      }
      #previewCanvas {
        max-width: 86vw;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Image Crop Tool</h2>
    <input type="file" id="imageInput" accept="image/*" />
    <div class="canvas-wrapper">
      <canvas id="imageCanvas"></canvas>
      <div id="cropBox"></div>
    </div>
    <button id="cropBtn">Crop & Preview</button>
    <div class="preview">
      <h3>Preview & Download</h3>
      <canvas id="previewCanvas"></canvas>
      <a id="downloadBtn" href="#" download="cropped-image.png">Download Cropped Image</a>
    </div>
  </div>
  <script>
    const imageInput = document.getElementById('imageInput');
    const imageCanvas = document.getElementById('imageCanvas');
    const previewCanvas = document.getElementById('previewCanvas');
    const cropBtn = document.getElementById('cropBtn');
    const cropBox = document.getElementById('cropBox');
    const downloadBtn = document.getElementById('downloadBtn');

    const ctx = imageCanvas.getContext('2d');
    const previewCtx = previewCanvas.getContext('2d');
    let image = new window.Image();
    let startX, startY, endX, endY, isDragging = false, isImageLoaded = false;

    function drawImageToCanvas(file) {
      const reader = new FileReader();
      reader.onload = (evt) => {
        image.onload = () => {
          // Fit canvas to image (limit width for mobile)
          const maxW = 320;
          let scale = Math.min(1, maxW / image.width);
          imageCanvas.width = image.width * scale;
          imageCanvas.height = image.height * scale;
          ctx.clearRect(0, 0, imageCanvas.width, imageCanvas.height);
          ctx.drawImage(image, 0, 0, imageCanvas.width, imageCanvas.height);
          isImageLoaded = true;
          cropBox.style.display = 'none';
        };
        image.src = evt.target.result;
      };
      reader.readAsDataURL(file);
    }

    // Handle file change
    imageInput.addEventListener('change', (e) => {
      if (e.target.files && e.target.files[0]) {
        drawImageToCanvas(e.target.files[0]);
      }
    });

    // Crop box handling
    imageCanvas.addEventListener('mousedown', function(e) {
      if (!isImageLoaded) return;
      isDragging = true;
      const rect = imageCanvas.getBoundingClientRect();
      startX = e.clientX - rect.left;
      startY = e.clientY - rect.top;
      cropBox.style.display = 'block';
      cropBox.style.left = `${startX}px`;
      cropBox.style.top = `${startY}px`;
      cropBox.style.width = `0px`;
      cropBox.style.height = `0px`;
    });

    imageCanvas.addEventListener('mousemove', function(e) {
      if (!isDragging) return;
      const rect = imageCanvas.getBoundingClientRect();
      endX = e.clientX - rect.left;
      endY = e.clientY - rect.top;
      let left = Math.min(startX, endX);
      let top = Math.min(startY, endY);
      let width = Math.abs(endX - startX);
      let height = Math.abs(endY - startY);
      cropBox.style.left = `${left}px`;
      cropBox.style.top = `${top}px`;
      cropBox.style.width = `${width}px`;
      cropBox.style.height = `${height}px`;
    });

    window.addEventListener('mouseup', function(e) {
      if (isDragging) {
        isDragging = false;
      }
    });

    // Cropping logic
    cropBtn.addEventListener('click', function() {
      if (cropBox.style.display === 'none' || cropBox.style.width === '0px') return;
      let sx = parseInt(cropBox.style.left);
      let sy = parseInt(cropBox.style.top);
      let sw = parseInt(cropBox.style.width);
      let sh = parseInt(cropBox.style.height);

      // Support for scaling
      let scale = image.width / imageCanvas.width;
      previewCanvas.width = sw;
      previewCanvas.height = sh;
      previewCtx.clearRect(0, 0, sw, sh);

      previewCtx.drawImage(
        image,
        sx*scale, sy*scale, sw*scale, sh*scale, // source
        0, 0, sw, sh                           // destination
      );

      // Set download
      downloadBtn.href = previewCanvas.toDataURL('image/png');
    });

    // Reset cropBox if image reloaded
    imageInput.addEventListener('click', () => {
      cropBox.style.display = 'none';
    });
  </script>
</body>
</html>
